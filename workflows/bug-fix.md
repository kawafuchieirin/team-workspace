# バグ修正ワークフロー

バグ報告を受けてから修正・検証完了までの標準ワークフロー。

## フロー概要

```
バグ報告
    │
    ▼
[Phase 1] PM: バグ分析・担当割り当て
    │
    ▼
[Phase 2] 担当エンジニア: 調査・修正
    │
    ▼
[Phase 3] Tester: 修正検証・リグレッションテスト
    │  ※未修正 or リグレッション → Phase 2 に差し戻し
    ▼
[Phase 4] Security Engineer: セキュリティ影響確認（必要な場合のみ）
    │
    ▼
[Phase 5] PM: 修正レビュー・クローズ判定
```

## Phase 1: バグ分析・担当割り当て（PM）

### 入力
- バグ報告（ユーザーからの報告 or Tester からのバグ報告）

### 実行内容
1. バグの再現性確認
2. 深刻度の判定
3. 影響範囲の分析
4. 根本原因の推定（フロントエンド / バックエンド / 両方）
5. 担当エンジニアの割り当て

### 深刻度と対応優先度

| 深刻度 | 基準 | 対応期限 |
|--------|------|---------|
| **Critical** | サービス停止、データ損失 | 即座に対応 |
| **High** | 主要機能の障害 | 最優先で対応 |
| **Medium** | 一部機能の不具合、ワークアラウンドあり | 通常優先度 |
| **Low** | 表示崩れ、軽微なUX問題 | 次スプリントでも可 |

### 出力
- バグ分析結果
- タスク割り当て（`templates/task-assignment.md` 形式）

### 起動コマンド
```bash
claude --system-prompt "$(cat agents/pm.md)" "バグ報告: ..."
```

## Phase 2: 調査・修正（担当エンジニア）

### 入力
- PMからのタスク割り当て
- バグの再現手順

### 実行内容
1. バグの再現確認
2. 根本原因の特定
3. 修正方針の決定
4. 修正の実装
5. 修正に対するテスト追加（リグレッション防止）
6. 引き継ぎレポート作成

### 修正のガイドライン
- 症状の対処ではなく、根本原因を修正する
- 修正箇所を最小限に抑える（影響範囲の最小化）
- 必ずテストを追加する（同じバグが再発しないように）
- 関連する箇所に同様のバグがないか確認する

### 出力
- 修正されたコード
- 追加されたテスト
- 引き継ぎレポート（`templates/handoff-report.md` 形式）

### 起動コマンド
```bash
# Frontend のバグの場合
claude --system-prompt "$(cat agents/frontend-engineer.md)" "バグ修正: ..."

# Backend のバグの場合
claude --system-prompt "$(cat agents/backend-engineer.md)" "バグ修正: ..."
```

## Phase 3: 修正検証・リグレッションテスト（Tester）

### 入力
- エンジニアの引き継ぎレポート
- 元のバグ報告

### 実行内容
1. バグが修正されたことの確認
2. 修正に伴うリグレッションがないことの確認
3. 追加されたテストの妥当性確認
4. テスト結果の報告

### 検証基準
- [ ] 報告されたバグが再現しないこと
- [ ] 既存テストがすべてパスすること
- [ ] 追加されたテストが適切であること
- [ ] 関連機能に影響がないこと

### 差し戻し条件
- バグが修正されていない
- 新たなバグが発生している（リグレッション）
- テストが不十分

### 出力
- 検証結果
- 引き継ぎレポート（`templates/handoff-report.md` 形式）

### 起動コマンド
```bash
claude --system-prompt "$(cat agents/tester.md)" "修正検証: ..."
```

## Phase 4: セキュリティ影響確認（Security Engineer）

> このフェーズはPMの判断で実行する。セキュリティ関連のバグ、認証・認可の変更、入力処理の変更等の場合に実行する。

### 入力
- 修正内容の引き継ぎレポート
- 元のバグ報告

### 実行内容
1. 修正がセキュリティに影響しないことの確認
2. 修正によって新たな脆弱性が生まれていないかの確認
3. セキュリティ関連のバグの場合、修正が十分かの確認

### 出力
- セキュリティ影響確認結果
- 引き継ぎレポート（`templates/handoff-report.md` 形式）

### 起動コマンド
```bash
claude --system-prompt "$(cat agents/security-engineer.md)" "セキュリティ影響確認: ..."
```

## Phase 5: 修正レビュー・クローズ判定（PM）

### 入力
- 全フェーズの引き継ぎレポート
- テスト検証結果
- セキュリティ影響確認結果（実行した場合）

### 実行内容
1. 修正内容の妥当性確認
2. テスト結果の確認
3. クローズ判定

### クローズ判定基準
- [ ] バグが修正されている
- [ ] テスト検証を通過している
- [ ] リグレッションがない
- [ ] セキュリティ影響の確認が完了している（該当する場合）

### 出力
- クローズ判定結果（クローズ / 差し戻し）

## 緊急バグ対応（Hotfix）

Critical な本番バグの場合、以下の短縮フローを使用:

```
バグ報告 → PM: 緊急度判定
         → 担当エンジニア: 即時修正
         → Tester: 最小限の検証
         → PM: クローズ判定
         → （後日）包括的なテスト・セキュリティ監査
```

注意: Hotfixは最小限の修正に留め、包括的な対応は後日行う。
